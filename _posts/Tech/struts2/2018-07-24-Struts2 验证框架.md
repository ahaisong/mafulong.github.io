---
layout: post
category: struts2
title: Struts2 验证框架
---


## Struts2 验证框架

### 创建Action
那么，让我们定义一个小的action类：Employee，然后添加一个名为validate()的方法，如下Employee.java文件所示。确保action类扩展了ActionSupport类，否则将不会执行validate方法。

```java
package cn.w3cschool.struts2;

import com.opensymphony.xwork2.ActionSupport;

public class Employee extends ActionSupport{
   private String name;
   private int age;
   
   public String execute() 
   {
       return SUCCESS;
   }
   public String getName() {
       return name;
   }
   public void setName(String name) {
       this.name = name;
   }
   public int getAge() {
       return age;
   }
   public void setAge(int age) {
       this.age = age;
   }

   public void validate()
   {
      if (name == null || name.trim().equals(""))
      {
         addFieldError("name","The name is required");
      }
      if (age < 28 || age > 65)
      {
         addFieldError("age","Age must be in between 28 and 65");
      }
   }
}

```

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC
   "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
   "http://struts.apache.org/dtds/struts-2.0.dtd">

<struts>
   <constant name="struts.devMode" value="true" />
   <package name="helloworld" extends="struts-default">

      <action name="empinfo" 
         class="cn.w3cschool.struts2.Employee"
         method="execute">
         <result name="input">/index.jsp</result>
         <result name="success">/success.jsp</result>
      </action>

   </package>

</struts>
```

### 这个验证是如何进行的？
当用户按下提交按钮时，Struts2 将自动执行validate方法，如果方法中列出的任何if语句为真，Struts2 将调用addFieldError方法。如果添加了任何错误信息，Struts2 将不会调用execute方法。否则，Struts2 框架将返回input作为调用操作的结果。

因此，当验证失败并且Struts2 返回input时，Struts2 框架将重新显示index.jsp文件。由于我们使用Struts2 的form标签，Struts2 会自动在form字段上方添加错误信息。

这些错误信息是我们在addFieldError方法调用中指定的信息。addFieldError方法接受两个参数，第一个是出错时应用的form字段名称，第二个是在form字段上方显示的错误信息。

## XML验证
第二种进行验证的方法是在action类旁边放置一个xml文件。Struts2 基于XML的验证提供了更多的验证方式，如email验证、integer range验证、form验证、expression验证、regex验证、required验证、requiredstring验证、stringlength验证等。

xml文件需要命名为'[action-class]'-validation.xml。因此，在我们的示例中，创建了一个名为Employee-validation.xml的文件，其含以下内容：

```xml
<!DOCTYPE validators PUBLIC 
"-//OpenSymphony Group//XWork Validator 1.0.2//EN"
"http://www.opensymphony.com/xwork/xwork-validator-1.0.2.dtd">

<validators>
   <field name="name">
      <field-validator type="required">
         <message>
            The name is required.
         </message>
      </field-validator>
   </field>

   <field name="age">
     <field-validator type="int">
         <param name="min">29</param>
         <param name="max">64</param>
         <message>
            Age must be in between 28 and 65
         </message>
      </field-validator>
   </field>
</validators>
```
