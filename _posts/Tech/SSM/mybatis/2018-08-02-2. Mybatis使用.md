---
layout: post
category: SSM
title: Mybatis使用
tags: Mybatis
---


## 创建项目和模块
记得model添加maven

添加pom.xml，比如junit,mybatis,sql-connector

[my github link](https://github.com/mafulong/mybatisDemo)

## 配置mybatis-config.xml
添加配置，在resources下新建文件mybatis-config.xml，详情可见[官网xml](http://www.mybatis.org/mybatis-3/getting-started.html)

配置用户名和密码，和Mysql驱动名，记得建立mybatis数据库

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://localhost:3306/mybatis"/>
                <property name="username" value="root"/>
                <property name="password" value="root"/>
            </dataSource>
        </environment>
    </environments>
    <mappers>
        <mapper resource="org/mybatis/example/BlogMapper.xml"/>
    </mappers>
</configuration>
```

## 数据库建表
```sql
CREATE TABLE IF NOT EXISTS `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `age` int(11),
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

## 运行主要代码
```java
package com.mfl.mybatisdemo;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.IOException;
import java.io.InputStream;

public class App {
    public static void main(String[] args){
        try{
            String resource = "mybatis-config.xml";
            InputStream inputStream = Resources.getResourceAsStream(resource);
            SqlSessionFactory sqlSessionFactory =
                    new SqlSessionFactoryBuilder().build(inputStream);
            SqlSession sqlSession=sqlSessionFactory.openSession();
            System.out.println(sqlSession);
        }catch (IOException e){

        }

    }
}

```

## 编写mapper文件

### 创建User类和user对应
```java
package com.mfl.model;

public class User {
    private Integer id;
    private String name;
    private int age;

    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", age=" + age +
                '}';
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}

```

### 创建UserMapper.xml
在与User类的同包下创建UserMapper.xml

namespace作为名称空间，任何方式，一般类名小写

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="users">
    <insert id="insert">
        insert into users(name,age) values (#{name},#{age})
    </insert>
</mapper>
```

修改mybatis-config.xml，引入UserMapper.xml
```xml
    <mappers>
        <mapper resource="com/mfl/model/UserMapper.xml"/>
    </mappers>
```

## App main
单元测试

```java
package com.mfl.mybatisdemo.test;

import com.mfl.model.User;
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;
import org.junit.Test;

import java.io.IOException;
import java.io.InputStream;
import java.util.List;

public class TestCRUD {
    @Test
    public void insert() throws Exception{

        String resource = "mybatis-config.xml";
        InputStream inputStream = Resources.getResourceAsStream(resource);
        SqlSessionFactory sqlSessionFactory =
                new SqlSessionFactoryBuilder().build(inputStream);
        SqlSession sqlSession=sqlSessionFactory.openSession();
        User u=new User();
        u.setName("mafulong");
        u.setAge(22);
        sqlSession.insert("users.insert",u);
        sqlSession.commit();
        sqlSession.close();
        System.out.println(sqlSession);

    }

    @Test
    public void update() throws Exception{
        String resource = "mybatis-config.xml";
        InputStream inputStream = Resources.getResourceAsStream(resource);
        SqlSessionFactory sqlSessionFactory =
                new SqlSessionFactoryBuilder().build(inputStream);
        SqlSession sqlSession=sqlSessionFactory.openSession();
        User u=new User();
        u.setName("mafulongUpdate");
        u.setAge(24);
        u.setId(1);
        sqlSession.update("users.update",u);
        sqlSession.commit();
        sqlSession.close();
    }
    @Test
    public void selectOne() throws Exception{
        String resource = "mybatis-config.xml";
        InputStream inputStream = Resources.getResourceAsStream(resource);
        SqlSessionFactory sqlSessionFactory =
                new SqlSessionFactoryBuilder().build(inputStream);
        SqlSession sqlSession=sqlSessionFactory.openSession();
        User user=sqlSession.selectOne("users.selectOne",1);
        System.out.println(user);
        sqlSession.commit();
        sqlSession.close();
    }
    @Test
    public void selectALL() throws Exception{
        String resource = "mybatis-config.xml";
        InputStream inputStream = Resources.getResourceAsStream(resource);
        SqlSessionFactory sqlSessionFactory =
                new SqlSessionFactoryBuilder().build(inputStream);
        SqlSession sqlSession=sqlSessionFactory.openSession();
        List<User> list=sqlSession.selectList("users.selectList",24);
        System.out.println(list);
        sqlSession.commit();
        sqlSession.close();
    }
}


```

### UserMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="users">
    <insert id="insert">
        insert into users(name,age) values (#{name},#{age})
    </insert>
    <update id="update" >
        update users set name=#{name} where age=#{age}
    </update>
    <select id="selectOne" parameterType="int" resultType="com.mfl.model.User">
        select * from users where id=#{id1}
    </select>
    <select id="selectList" parameterType="int" resultType="com.mfl.model.User">
        select * from users where age=#{age}
    </select>
</mapper>
```




